!function(a){"use strict";function b(){a(".wcst_low_stock").html(""),a(".wcst_deal_expiry").not(".wcst_static").html(""),a(".woocommerce-variation.single_variation .wcst_you_save_variation").html("")}function c(){if(void 0!==wcst_data.settings&&void 0!==wcst_data.settings.deal_expiry)for(var b in wcst_data.settings.deal_expiry){var c=".wcst_deal_expiry_key_"+wcst_data.current_postid+"_"+b;if(0!==a(c).length){var f,g,h,i,k,l,o=wcst_data.settings.deal_expiry[b],p=a(c).find("span").attr("data-date"),q={to:p},r=q.to-wcst_data.utc0_time,s="";if(!a(c).hasClass("wcst_deal_expiry_variable")&&!a(c).hasClass("wcst_timer")&&"reverse_timer"!=o.display_mode){if("reverse_date"===o.display_mode&&(f=humanized_time_span(j(q.to),j(wcst_data.utc0_time)),g=o.reverse_date_label,h="{{time_left}}"),o.switch_period>0){if(!(r<3600*o.switch_period))continue;f="",g=o.reverse_timer_label,h="{{countdown_timer}}",i=" wcst_timer",k="days",r<86400&&(k="hrs")}f='<span data-diff="'+(q.to-wcst_data.utc0_time)+'" data-display="'+k+'">'+f+"</span>"," wcst_timer"==i&&a(".wcst_deal_expiry.wcst_deal_expiry_key_"+wcst_data.current_postid+"_"+b).addClass("wcst_timer"),l=h,s=new RegExp(l,"g"),g=g.replace(s,f),a(".wcst_deal_expiry.wcst_deal_expiry_key_"+wcst_data.current_postid+"_"+b).html(g)}}}a(".wcst_timer,.wcst_manual_timer").each(function(){a.ajax({url:wcst_data.ajax_url,type:"POST",data:{action:"wcst_refreshed_times",location:document.location.href,endDate:a(this).children("span").attr("data-date")},beforeSend:function(){m++},success:function(b){n++,a(".wcst_timer,.wcst_manual_timer").find("span[data-date='"+b.old_diff+"']").each(function(){jQuery(this).attr("data-diff",b.diff)}),m===n&&(e(),d())}})})}function d(){a(".wcst_manual_timer").length>0&&a(".wcst_manual_timer").each(function(){var b,c=a(this),d=c.children("span");b=d.attr("data-format");var e=parseInt(d.attr("data-diff")),f=(new Date).getTime()+1e3*e;d.wcstCountdown(f,function(c){a(this).text(c.strftime(b))})})}function e(){if(a(".wcst_timer").length>0){l=wcst_data.hard_texts;var b="D",c="D",d="h",e="h",f="m",g="m",h="s",i="s";void 0!==l.day&&""!=l.day&&(b=l.day),void 0!==l.days&&""!=l.days&&(c=l.days),void 0!==l.hr&&""!=l.hr&&(d=l.hr),void 0!==l.hrs&&""!=l.hrs&&(e=l.hrs),void 0!==l.mins&&""!=l.mins&&(f=l.mins),void 0!==l.min&&""!=l.min&&(g=l.min),void 0!==l.sec&&""!=l.sec&&(h=l.sec),void 0!==l.secs&&""!=l.secs&&(i=l.secs),a(".wcst_timer").each(function(){var j,k=a(this),l=k.children("span").not(".amount"),m=parseInt(l.attr("data-diff")),n=(new Date).getTime()+1e3*m,o=l.attr("data-display");l.wcstCountdown(n,function(k){var l=k.offset.totalDays>1?c:b,m=k.offset.hours>1?e:d,n=k.offset.minutes>1?f:g,p=k.offset.seconds>1?i:h;j="%H"+m+" %M"+n+" %S"+p,"days"==o&&(j="%-D "+l+" %H "+m+" %M "+n+" %S "+p),a(this).text(k.strftime(j))})})}}function f(a,b,c,d){var e,f,g=a.scarcity_label,h=a.assurance_label,i=a.out_of_stock_label,j=null!==b?d.wcst_stock_qty:"";e="{{stock_quantity_left}}",f=new RegExp(e,"g"),g=g.replace(f,j),e="{{stock_quantity_left}}",f=new RegExp(e,"g"),h=h.replace(f,j);return!0===c?!1===d.wcst_manage_stock?'<div class="wcst_low_stock_assurance"><span>'+h+"</span></div>":0!==b&&null!==b&&""!==b||!1!==d.backorders_allowed?"0"==d.wcst_stock_qty&&!0===d.backorders_allowed?'<div class="wcst_low_stock_assurance"><span>'+h+"</span></div>":"scarcity"==a.default_mode?'<div class="wcst_low_stock_scarcity"><span>'+g+"</span></div>":a.switch_scarcity_min_stock>0&&a.switch_scarcity_min_stock>=d.wcst_stock_qty?'<div class="wcst_low_stock_scarcity"><span>'+g+"</span></div>":'<div class="wcst_low_stock_assurance"><span>'+h+"</span></div>":'<div class="wcst_low_stock_assurance"><span>'+h+"</span></div>":'<div class="wcst_low_stock_out"><span>'+i+"</span></div>"}function g(b,c,d){var e,f;if("yes"===c.show_below_variation_price){var g=d.display_regular_price,i=d.display_price,j=c.label,k=Math.abs(g-i);if(k>0&&a(".woocommerce-variation.single_variation").length>0&&a(".woocommerce-variation.single_variation .woocommerce-variation-price").length>0){var l=k/g*100,m=wcst_data.wc_decimal_count?wcst_data.wc_decimal_count:1;l=l.toFixed(m),l%1!=0&&"yes"!==c.hide_decimal_in_saving_percentage||(l=Math.floor(l)),e="{{savings_value}}",f=new RegExp(e,"g"),j=j.replace(f,'<span class="you_save_value">'+h(k)+"</span>"),e="{{savings_percentage}}",f=new RegExp(e,"g"),j=j.replace(f,'<span class="you_save_percentage">'+l+"%</span>"),e="{{savings_value_percentage}}",f=new RegExp(e,"g"),j=j.replace(f,'<span class="you_save_value_percentage">'+h(k)+" ("+l+"%)</span>"),e="{{regular_price}}",f=new RegExp(e,"g");var n='<span class="woocommerce-Price-amount amount">'+h(g)+"</span>";j=j.replace(f,n);var o='<span class="woocommerce-Price-amount amount">'+h(i)+"</span>";e="{{sale_price}}",f=new RegExp(e,"g"),j=j.replace(f,o),a(".woocommerce-variation.single_variation").find(".wcst_savings_variation").remove(),a(".woocommerce-variation.single_variation .woocommerce-variation-price").after('<div class="wcst_savings_variation wcst_savings_variation_key_'+wcst_data.current_postid+"_"+b+'">'+j+"</div>")}}}function h(a){var b;return"left"===wcst_data.currency_pos?b='<span class="woocommerce-Price-currencySymbol">'+wcst_data.currency+"</span>"+i(a,wcst_data.wc_decimal_count,wcst_data.wc_decimal_sep,wcst_data.wc_thousand_sep):"left_space"===wcst_data.currency_pos?b='<span class="woocommerce-Price-currencySymbol">'+wcst_data.currency+"</span> "+i(a,wcst_data.wc_decimal_count,wcst_data.wc_decimal_sep,wcst_data.wc_thousand_sep):"right"===wcst_data.currency_pos?b=i(a,wcst_data.wc_decimal_count,wcst_data.wc_decimal_sep,wcst_data.wc_thousand_sep)+'<span class="woocommerce-Price-currencySymbol">'+wcst_data.currency+"</span> ":"right_space"===wcst_data.currency_pos&&(b=i(a,wcst_data.wc_decimal_count,wcst_data.wc_decimal_sep,wcst_data.wc_thousand_sep)+' <span class="woocommerce-Price-currencySymbol">'+wcst_data.currency+"</span> "),b}function i(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):0,g=void 0===d?",":d,h=void 0===c?".":c,i="",j=function(a,b){var c=Math.pow(10,b);return""+Math.round(a*c)/c};return i=(f?j(e,f):""+Math.round(e)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=new Array(f-i[1].length+1).join("0")),i.join(h)}function j(a){var b=new Date(1e3*a),c=b.getFullYear(),d=b.getMonth(),e=b.getDate(),f=b.getHours(),g="0"+b.getMinutes(),h="0"+b.getSeconds();return d+=1,d<9&&(d="0"+d),f<9&&(f="0"+f),c+"/"+d+"/"+e+" "+f+":"+g.substr(-2)+":"+h.substr(-2)}function k(b,c,d,f){var g,h,i,k="",l="",m=0;m=d.to-wcst_data.utc0_time;var n,o,p,q,r=f.display_regular_price,s=f.display_price;"reverse_date"===c.display_mode||"expiry_date"===c.display_mode?("reverse_date"===c.display_mode&&(g=humanized_time_span(j(d.to),j(wcst_data.utc0_time)),h=c.reverse_date_label,i="{{time_left}}"),"expiry_date"==c.display_mode&&(g=f.wcst_sale_to_val,h=c.expiry_date_label,i="{{end_date}}"),c.switch_period>0&&m<3600*c.switch_period&&(h=c.reverse_timer_label,i="{{countdown_timer}}",k=" wcst_timer",l="days",m<86400&&(l="hrs")),g='<span data-diff="'+(d.to-wcst_data.utc0_time)+'" data-display="'+l+'">'+g+"</span>"," wcst_timer"==k?a(".wcst_deal_expiry.wcst_deal_expiry_key_"+wcst_data.current_postid+"_"+b).not(".wcst_static").addClass("wcst_timer"):a(".wcst_deal_expiry.wcst_deal_expiry_key_"+wcst_data.current_postid+"_"+b).not(".wcst_static").removeClass("wcst_timer"),n=i,o=new RegExp(n,"g"),h=h.replace(o,g),n="{{regular_price}}",o=new RegExp(n,"g"),p='<span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">'+wcst_data.currency+"</span>"+r.toFixed(2)+"</span>",h=h.replace(o,p),q='<span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">'+wcst_data.currency+"</span>"+s.toFixed(2)+"</span>",n="{{sale_price}}",o=new RegExp(n,"g"),h=h.replace(o,q),a(".wcst_deal_expiry.wcst_deal_expiry_key_"+wcst_data.current_postid+"_"+b).not(".wcst_static").html(h),e()):"reverse_timer"===c.display_mode&&(h=c.reverse_timer_label,i="{{countdown_timer}}",k=" wcst_timer",l="days",m<86400&&(l="hrs"),g='<span data-diff="'+(d.to-wcst_data.utc0_time)+'" data-display="'+l+'">'+g+"</span>"," wcst_timer"==k&&a(".wcst_deal_expiry").addClass("wcst_timer"),n=i,o=new RegExp(n,"g"),h=h.replace(o,g),n="{{regular_price}}",o=new RegExp(n,"g"),p='<span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">'+wcst_data.currency+"</span>"+r.toFixed(2)+"</span>",h=h.replace(o,p),q='<span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">'+wcst_data.currency+"</span>"+s.toFixed(2)+"</span>",n="{{sale_price}}",o=new RegExp(n,"g"),h=h.replace(o,q),a(".wcst_deal_expiry.wcst_deal_expiry_key_"+wcst_data.current_postid+"_"+b).not(".wcst_static").html(h),e())}var l,m=0,n=0;a(".variations_form").on("woocommerce_variation_select_change",function(){b()}),a(".variations_form").on("show_variation",function(c,d){if(b(),void 0!==d&&"undefined"!=typeof wcst_data&&void 0!==wcst_data.settings){var e=(d.variation_id,{});e.from=d.wcst_sale_from,e.to=d.wcst_sale_to;var h=d.is_in_stock,i=1;d.display_price==d.display_regular_price&&(i=0);var j=d.max_qty;if(0===j&&(h=!1),0===h)return!1;void 0!==wcst_data.settings.low_stock&&-1!==wcst_data.compatibility.low_stock.indexOf(wcst_data.product_type)&&Object.keys(wcst_data.settings.low_stock).length>0&&a(".wcst_low_stock").length>0&&(a(".wcst_low_stock").html(""),a.each(wcst_data.settings.low_stock,function(b,c){var e=f(c,j,h,d);!0===h?a(".wcst_low_stock.wcst_low_stock_key_"+wcst_data.current_postid+"_"+b).removeClass("wcst_out_of_stock"):a(".wcst_low_stock.wcst_low_stock_key_"+wcst_data.current_postid+"_"+b).addClass("wcst_out_of_stock"),a(".wcst_low_stock.wcst_low_stock_key_"+wcst_data.current_postid+"_"+b).html(e)})),void 0!==wcst_data.settings.savings&&-1!==wcst_data.compatibility.savings.indexOf(wcst_data.product_type)&&Object.keys(wcst_data.settings.savings).length>0&&1===i&&!0===h&&a.each(wcst_data.settings.savings,function(a,b){g(a,b,d)}),void 0!==wcst_data.settings.deal_expiry&&-1!==wcst_data.compatibility.deal_expiry.indexOf(wcst_data.product_type)&&Object.keys(wcst_data.settings.deal_expiry).length>0&&1===i&&!0===h&&""!==e.to&&e.to>0&&wcst_data.utc0_time<e.to&&""!==e.from&&e.from>0&&wcst_data.utc0_time>e.from&&a.each(wcst_data.settings.deal_expiry,function(a,b){k(a,b,e,d)})}}),a(document.body).on("wc_fragments_refreshed",function(){e()}),a(window).bind("load",function(){a(".wcst_deal_expiry,.wcst_manual_timer").length>0&&a.ajax({url:wcst_data.wcstajax_url,type:"POST",data:{wcst_action:"wcst_reset_current_time",location:document.location.href,product:wcst_data.current_postid},success:function(a){!0===a.hasOwnProperty("utc0_time")&&(wcst_data.utc0_time=a.utc0_time,c())}})})}(jQuery);